<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>OpenLayers Test</title>

    <!-- ExtJS -->
    <script type="text/javascript" src="http://extjs.cachefly.net/builds/ext-cdn-771.js"></script>
    <link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-2.2.1/resources/css/ext-all.css" />
    <link rel="stylesheet" type="text/css" href="http://extjs.cachefly.net/ext-2.2.1/examples/shared/examples.css" />

    <!-- OpenLayers -->
    <script type="text/javascript" src="http://www.openlayers.org/api/OpenLayers.js"></script>

    <!-- GeoExt -->
    <script type="text/javascript" src="./scripts/GeoExt.js"></script>
    <script type="text/javascript">
      OpenLayers.ProxyHost = "/cgi-bin/proxy.cgi?url=";
      Ext.onReady(function() {

        //Setup OpenLayers Map
        var map = new OpenLayers.Map();

        //Setup WFS Style
        var styleMap = new OpenLayers.StyleMap(
          OpenLayers.Util.applyDefaults({
            fillColor: "green",
            fillOpacity: 1,
            strokeColor: "black"
            },
            OpenLayers.Feature.Vector.style["default"]
          ));

        //Setup OpenLayers Layer
        var base = new OpenLayers.Layer.WMS(
          "MetaCarta WMS",
          "http://labs.metacarta.com/wms-c/Basic.py",
          { layers: "basic" }
          );

        var geoserverWMS = new OpenLayers.Layer.WMS(
          "Geoserver WMS: Itasca Lakes",
          "http://tub.ath.cx:8080/geoserver/wms",
          {layers: "prco303:itasca", transparent: "true"},
          {isBaseLayer: false, projection: "EPSG:26915"}
          );

        var geoserver = new OpenLayers.Layer.Vector( "GeoServer WFS: Itasca Lakes", {
          strategies: [new OpenLayers.Strategy.BBOX()],
          styleMap: styleMap,
          //projection: new OpenLayers.Projection("EPSG:26915"),
          protocol: new OpenLayers.Protocol.WFS({
              version: "1.1.0",
              url: "http://tub.ath.cx:8080/geoserver/wfs",
              featureType: "prco303:itasca",
              //featureNS: "http://tub.ath.cx/geoserver/wfs",
              geometryName: "the_geom",
              srs: "EPSG:26915"
              })
          });

        map.addLayer( base );

        //Setup GeoExt Stores
        //var store = new GeoExt.data.FeatureStore({
          //layer: geoserver,
        //  fields: [
         //   {name: "prco303:lake_name", type: "string"}
         //   ],
         // proxy: new GeoExt.data.ProtocolProxy({
         //   
         //   }),
        //  autoLoad: true
        //  });

        //Setup GeoExt Panels
      //  var gridPanel = new Ext.grid.GridPanel({
       //   title: "Feature Table - Itasca Lakes",
       //   region: "south",
       //   viewConfig: {forceFit: true},
         // store: store,
       //   cm: new Ext.grid.ColumnModel({
       //     defaults: { sortable: true },
        //    columns: [ {header: "Lake Name", dataIndex: "prco303lake_name"} ]
        //    })
        //  });

        var mapPanel = new GeoExt.MapPanel({
          title: "GeoExt Test",
          region: "center",
          width: 600,
          map: map,
          layers: [ geoserver, geoserverWMS ],
          extent: new OpenLayers.Bounds(-94.428, 47.018, -93.06, 47.889)
          });

        var layerList = new GeoExt.tree.LayerContainer({
          text: "All Layers",
          layerStore: mapPanel.layers,
          leaf: false,
          expanded: true
          });

        var layerTree = new Ext.tree.TreePanel({
          title: "Map Layers",
          region: "east",
          width: 320,
          root: layerList
          });

        var mainPanel = new Ext.Panel({
          renderTo: "map",
          layout: "border",
          height: 400,
          width: 920,
          items: [ mapPanel, layerTree]
          });
      });  
    </script>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
